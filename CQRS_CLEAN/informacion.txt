referencias

application con domain
infraestructure con domain
api con application
api con infraestructure


API ‚Üí Application ‚Üí Domain
API ‚Üí Infrastructure ‚Üí Domain


MINI_VENTAS.API

dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
dotnet add package Swashbuckle.AspNetCore
dotnet add package MediatR.Extensions.Microsoft.DependencyInjection  // SE INSTALA CUANDO SE USA NET CORE MENOR A 9 

MINIVENTAS.Application

dotnet add package MediatR
dotnet add package AutoMapper
dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection


MINIVENTAS.Infrastructure

dotnet add package Dapper
dotnet add package Microsoft.Data.SqlClient




APIS_CQRS/
‚îú‚îÄ MNI_VENTAS.API/              ‚Üí Capa de Presentaci√≥n (Web API)
‚îú‚îÄ MNI_VENTAS.Application/      ‚Üí Capa de Casos de uso (l√≥gica)
‚îú‚îÄ MNI_VENTAS.Domain/           ‚Üí Capa de Entidades y contratos
‚îî‚îÄ MNI_VENTAS.Infrastructure/   ‚Üí Capa de datos (Dapper, repositorios, contexto)


El Domain es el coraz√≥n ‚Üí conoce tus entidades reales.

El Application es el cerebro ‚Üí decide qu√© datos mover y c√≥mo exponerlos.

El Infrastructure es las manos ‚Üí ejecuta consultas o SPs con Dapper.

El API es la boca ‚Üí muestra el resultado al cliente.


| Tipo                             | D√≥nde vive     | Para qu√© sirve                                                  |
| -------------------------------- | -------------- | --------------------------------------------------------------- |
| **Entidad (`Producto`)**         | Domain         | Representa tu tabla o modelo de negocio base.                   |
| **DTO (`ListadoProductoDto`)**   | Application    | Representa datos ‚Äúcustomizados‚Äù para la API (SPs, joins, etc.). |
| **Repositorio (interface)**      | Domain         | Define qu√© operaciones se pueden hacer.                         |
| **Repositorio (implementaci√≥n)** | Infrastructure | Usa Dapper para ejecutar consultas.                             |
| **Handler**                      | Application    | Coordina el flujo de datos.                                     |
| **Controller**                   | API            | Expone los endpoints HTTP.                                      |



üß† 1Ô∏è‚É£ DOMAIN ‚Äì Qu√© es y qu√© lleva

üëâ Es la base del proyecto: define las entidades y las interfaces (contratos).
No tiene l√≥gica de infraestructura, ni dependencias a otros proyectos.

Carpetas:
MNI_VENTAS.Domain/
 ‚îú‚îÄ Entities/
 ‚îî‚îÄ Interfaces/


‚öôÔ∏è 2Ô∏è‚É£ INFRASTRUCTURE ‚Äì Dapper y acceso a datos

üëâ Aqu√≠ implementas lo que definiste en Domain.
Conectas con la base de datos usando Dapper y defines el contexto.

Carpetas:
MNI_VENTAS.Infrastructure/
 ‚îú‚îÄ Context/
 ‚îú‚îÄ Repositories/
 ‚îî‚îÄ DependencyInjection.cs

MNI_VENTAS.sln
‚îÇ
‚îú‚îÄ‚îÄ MNI_VENTAS.Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Entities/                üëà Entidades reales de negocio (tablas)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Producto.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cliente.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Venta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Models/                  üëà Modelos de lectura (SPs, vistas)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListadoProducto.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResumenVentas.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DetalleVenta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ Interfaces/              üëà Contratos (repositorios, servicios de dominio)
‚îÇ       ‚îú‚îÄ‚îÄ IProductoRepository.cs
‚îÇ       ‚îú‚îÄ‚îÄ IClienteRepository.cs
‚îÇ       ‚îî‚îÄ‚îÄ IVentaRepository.cs
‚îÇ
‚îú‚îÄ‚îÄ MNI_VENTAS.Application/
‚îÇ   ‚îú‚îÄ‚îÄ DTOs/                    üëà Objetos para transporte de datos al API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductoDto.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListadoProductoDto.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VentaDto.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Features/                üëà Implementaci√≥n CQRS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Commands/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CrearProductoCommand.cs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ActualizarProductoCommand.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Queries/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ GetAllProductosQuery.cs
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ GetProductoByIdQuery.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Mappings/                üëà AutoMapper profiles
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MappingProfile.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ DependencyInjection.cs   üëà Registro de servicios y handlers
‚îÇ
‚îú‚îÄ‚îÄ MNI_VENTAS.Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ Context/                 üëà Dapper context / conexi√≥n a BD
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DapperContext.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Repositories/            üëà Implementaciones concretas de interfaces
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductoRepository.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClienteRepository.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VentaRepository.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ DependencyInjection.cs   üëà Registro de repositorios en DI
‚îÇ
‚îî‚îÄ‚îÄ MNI_VENTAS.API/
    ‚îú‚îÄ‚îÄ Controllers/
    ‚îÇ   ‚îú‚îÄ‚îÄ ProductoController.cs
    ‚îÇ   ‚îú‚îÄ‚îÄ ClienteController.cs
    ‚îÇ   ‚îî‚îÄ‚îÄ VentaController.cs
    ‚îÇ
    ‚îú‚îÄ‚îÄ appsettings.json
    ‚îî‚îÄ‚îÄ Program.cs



| Capa               | Qu√© hace                                                  | Qu√© depende de              |
| ------------------ | --------------------------------------------------------- | --------------------------- |
| **Domain**         | Define entidades, modelos y contratos.                    | Nadie                       |
| **Infrastructure** | Implementa los contratos usando Dapper.                   | Domain                      |
| **Application**    | Orquesta la l√≥gica CQRS, usa repositorios y mapea a DTOs. | Domain                      |
| **API**            | Expone endpoints que llaman a Application.                | Application, Infrastructure |



| Capa               | Responsabilidad principal                                           | Ejemplo                                                    |
| ------------------ | ------------------------------------------------------------------- | ---------------------------------------------------------- |
| **API**            | Expone endpoints y maneja peticiones HTTP                           | `ProductosController`                                      |
| **Application**    | Contiene la l√≥gica de negocio (handlers, commands, queries)         | `CreateProductHandler`                                     |
| **Domain**         | Define entidades y contratos (interfaces, DTOs, modelos de negocio) | `IProductoRepository`, `Producto`                          |

| **Infrastructure** | Implementa persistencia, acceso a datos y servicios externos        | `ProductoRepository`, `FakeStoreApiProxy`, `DapperContext` |


[ API ]
   ‚îÇ
   ‚îú‚îÄ‚îÄ AddApplication()  ‚Üí usa casos de uso, DTOs, mediadores, validaciones.
   ‚îÇ
   ‚îî‚îÄ‚îÄ AddInfrastructure() ‚Üí registra Dapper, Repos, HttpClients, NLog, etc.

[ Application ]
   ‚îú‚îÄ‚îÄ Usa interfaces ‚Üí IProductoRepository, IFakeStoreApiProxy
   ‚îî‚îÄ‚îÄ Contiene l√≥gica de negocio (casos de uso)

[ Domain ]
   ‚îî‚îÄ‚îÄ Define entidades y reglas del negocio

[ Infrastructure ]
   ‚îú‚îÄ‚îÄ Implementa interfaces de Domain o Application
   ‚îî‚îÄ‚îÄ Maneja datos: BD, APIs externas, logs, etc



--ESUMEN ACTUALIZADO

[ API ]
   ‚îÇ
   ‚îú‚îÄ‚îÄ AddApplication()   -> registra casos de uso (MediatR, DTOs, validaciones)
   ‚îÇ
   ‚îî‚îÄ‚îÄ AddInfrastructure() -> registra implementaciones concretas (Dapper, HttpClients, repos, logging)


[ Application ]
   ‚îú‚îÄ Define casos de uso (Handlers, Commands/Queries)
   ‚îú‚îÄ Define DTOs que usa la app
   ‚îú‚îÄ Define interfaces necesarias por la app:
   ‚îÇ     ‚Ä¢ Interfaces de dominio (a veces en Domain) -> IProductoRepository (para BD propia)
   ‚îÇ     ‚Ä¢ Interfaces de servicios externos -> IFakeStoreApiProxy (cuando la app necesita consumir terceros)
   ‚îî‚îÄ No contiene implementaciones concretas


[ Domain ]
   ‚îî‚îÄ Entidades del negocio, reglas puras (a veces contiene interfaces de repositorio seg√∫n la convenci√≥n)

[ Infrastructure ]
   ‚îú‚îÄ Implementa las interfaces definidas (en Domain o Application)
   ‚îÇ     ‚Ä¢ ProductoRepository : IProductoRepository
   ‚îÇ     ‚Ä¢ FakeStoreApiProxy : IFakeStoreApiProxy
   ‚îú‚îÄ Maneja acceso a datos (Dapper/EF), HttpClients, logs, etc.
   ‚îî‚îÄ Expone m√©todo AddInfrastructure(configuration) para registrar todo en DI



| Capa            | Qu√© define                                              | Cu√°ndo poner una interfaz ah√≠                                                                                                                                                                                       |
| --------------- | ------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Domain**      | Reglas del negocio y contratos ‚Äúcentrales‚Äù del dominio. | Cuando la interfaz representa **una dependencia gen√©rica o estructural** del dominio, por ejemplo, un repositorio o un servicio externo fundamental.                                                                |
| **Application** | Casos de uso, DTOs, l√≥gica orquestadora.                | Cuando la interfaz representa **una dependencia espec√≠fica de un caso de uso**, o sea, algo que **solo sirve para una funcionalidad particular** (por ejemplo, un proxy de API temporal o una regla de validaci√≥n). |

| Caso                                                                                      | D√≥nde va la interfaz |
| ----------------------------------------------------------------------------------------- | -------------------- |
| El API forma parte del proceso del negocio (autenticaci√≥n, facturaci√≥n, validaci√≥n, etc.) | üß© **Domain**        |
| El API solo entrega datos externos que tu app consume o transforma                        | ‚öôÔ∏è **Application**   |
