referencias

application con domain
infraestructure con domain
api con application
api con infraestructure


API â†’ Application â†’ Domain
API â†’ Infrastructure â†’ Domain


MINI_VENTAS.API

dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
dotnet add package Swashbuckle.AspNetCore
dotnet add package MediatR.Extensions.Microsoft.DependencyInjection  // SE INSTALA CUANDO SE USA NET CORE MENOR A 9 

MINIVENTAS.Application

dotnet add package MediatR
dotnet add package AutoMapper
dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection


MINIVENTAS.Infrastructure

dotnet add package Dapper
dotnet add package Microsoft.Data.SqlClient




APIS_CQRS/
â”œâ”€ MNI_VENTAS.API/              â†’ Capa de PresentaciÃ³n (Web API)
â”œâ”€ MNI_VENTAS.Application/      â†’ Capa de Casos de uso (lÃ³gica)
â”œâ”€ MNI_VENTAS.Domain/           â†’ Capa de Entidades y contratos
â””â”€ MNI_VENTAS.Infrastructure/   â†’ Capa de datos (Dapper, repositorios, contexto)


El Domain es el corazÃ³n â†’ conoce tus entidades reales.

El Application es el cerebro â†’ decide quÃ© datos mover y cÃ³mo exponerlos.

El Infrastructure es las manos â†’ ejecuta consultas o SPs con Dapper.

El API es la boca â†’ muestra el resultado al cliente.


| Tipo                             | DÃ³nde vive     | Para quÃ© sirve                                                  |
| -------------------------------- | -------------- | --------------------------------------------------------------- |
| **Entidad (`Producto`)**         | Domain         | Representa tu tabla o modelo de negocio base.                   |
| **DTO (`ListadoProductoDto`)**   | Application    | Representa datos â€œcustomizadosâ€ para la API (SPs, joins, etc.). |
| **Repositorio (interface)**      | Domain         | Define quÃ© operaciones se pueden hacer.                         |
| **Repositorio (implementaciÃ³n)** | Infrastructure | Usa Dapper para ejecutar consultas.                             |
| **Handler**                      | Application    | Coordina el flujo de datos.                                     |
| **Controller**                   | API            | Expone los endpoints HTTP.                                      |



ðŸ§  1ï¸âƒ£ DOMAIN â€“ QuÃ© es y quÃ© lleva

ðŸ‘‰ Es la base del proyecto: define las entidades y las interfaces (contratos).
No tiene lÃ³gica de infraestructura, ni dependencias a otros proyectos.

Carpetas:
MNI_VENTAS.Domain/
 â”œâ”€ Entities/
 â””â”€ Interfaces/


âš™ï¸ 2ï¸âƒ£ INFRASTRUCTURE â€“ Dapper y acceso a datos

ðŸ‘‰ AquÃ­ implementas lo que definiste en Domain.
Conectas con la base de datos usando Dapper y defines el contexto.

Carpetas:
MNI_VENTAS.Infrastructure/
 â”œâ”€ Context/
 â”œâ”€ Repositories/
 â””â”€ DependencyInjection.cs

MNI_VENTAS.sln
â”‚
â”œâ”€â”€ MNI_VENTAS.Domain/
â”‚   â”œâ”€â”€ Entities/                ðŸ‘ˆ Entidades reales de negocio (tablas)
â”‚   â”‚   â”œâ”€â”€ Producto.cs
â”‚   â”‚   â”œâ”€â”€ Cliente.cs
â”‚   â”‚   â””â”€â”€ Venta.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Models/                  ðŸ‘ˆ Modelos de lectura (SPs, vistas)
â”‚   â”‚   â”œâ”€â”€ ListadoProducto.cs
â”‚   â”‚   â”œâ”€â”€ ResumenVentas.cs
â”‚   â”‚   â””â”€â”€ DetalleVenta.cs
â”‚   â”‚
â”‚   â””â”€â”€ Interfaces/              ðŸ‘ˆ Contratos (repositorios, servicios de dominio)
â”‚       â”œâ”€â”€ IProductoRepository.cs
â”‚       â”œâ”€â”€ IClienteRepository.cs
â”‚       â””â”€â”€ IVentaRepository.cs
â”‚
â”œâ”€â”€ MNI_VENTAS.Application/
â”‚   â”œâ”€â”€ DTOs/                    ðŸ‘ˆ Objetos para transporte de datos al API
â”‚   â”‚   â”œâ”€â”€ ProductoDto.cs
â”‚   â”‚   â”œâ”€â”€ ListadoProductoDto.cs
â”‚   â”‚   â””â”€â”€ VentaDto.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Features/                ðŸ‘ˆ ImplementaciÃ³n CQRS
â”‚   â”‚   â”œâ”€â”€ Commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ CrearProductoCommand.cs
â”‚   â”‚   â”‚   â””â”€â”€ ActualizarProductoCommand.cs
â”‚   â”‚   â””â”€â”€ Queries/
â”‚   â”‚       â”œâ”€â”€ GetAllProductosQuery.cs
â”‚   â”‚       â””â”€â”€ GetProductoByIdQuery.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Mappings/                ðŸ‘ˆ AutoMapper profiles
â”‚   â”‚   â””â”€â”€ MappingProfile.cs
â”‚   â”‚
â”‚   â””â”€â”€ DependencyInjection.cs   ðŸ‘ˆ Registro de servicios y handlers
â”‚
â”œâ”€â”€ MNI_VENTAS.Infrastructure/
â”‚   â”œâ”€â”€ Context/                 ðŸ‘ˆ Dapper context / conexiÃ³n a BD
â”‚   â”‚   â””â”€â”€ DapperContext.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Repositories/            ðŸ‘ˆ Implementaciones concretas de interfaces
â”‚   â”‚   â”œâ”€â”€ ProductoRepository.cs
â”‚   â”‚   â”œâ”€â”€ ClienteRepository.cs
â”‚   â”‚   â””â”€â”€ VentaRepository.cs
â”‚   â”‚
â”‚   â””â”€â”€ DependencyInjection.cs   ðŸ‘ˆ Registro de repositorios en DI
â”‚
â””â”€â”€ MNI_VENTAS.API/
    â”œâ”€â”€ Controllers/
    â”‚   â”œâ”€â”€ ProductoController.cs
    â”‚   â”œâ”€â”€ ClienteController.cs
    â”‚   â””â”€â”€ VentaController.cs
    â”‚
    â”œâ”€â”€ appsettings.json
    â””â”€â”€ Program.cs



| Capa               | QuÃ© hace                                                  | QuÃ© depende de              |
| ------------------ | --------------------------------------------------------- | --------------------------- |
| **Domain**         | Define entidades, modelos y contratos.                    | Nadie                       |
| **Infrastructure** | Implementa los contratos usando Dapper.                   | Domain                      |
| **Application**    | Orquesta la lÃ³gica CQRS, usa repositorios y mapea a DTOs. | Domain                      |
| **API**            | Expone endpoints que llaman a Application.                | Application, Infrastructure |



| Capa               | Responsabilidad principal                                           | Ejemplo                                                    |
| ------------------ | ------------------------------------------------------------------- | ---------------------------------------------------------- |
| **API**            | Expone endpoints y maneja peticiones HTTP                           | `ProductosController`                                      |
| **Application**    | Contiene la lÃ³gica de negocio (handlers, commands, queries)         | `CreateProductHandler`                                     |
| **Domain**         | Define entidades y contratos (interfaces, DTOs, modelos de negocio) | `IProductoRepository`, `Producto`                          |

| **Infrastructure** | Implementa persistencia, acceso a datos y servicios externos        | `ProductoRepository`, `FakeStoreApiProxy`, `DapperContext` |


[ API ]
   â”‚
   â”œâ”€â”€ AddApplication()  â†’ usa casos de uso, DTOs, mediadores, validaciones.
   â”‚
   â””â”€â”€ AddInfrastructure() â†’ registra Dapper, Repos, HttpClients, NLog, etc.

[ Application ]
   â”œâ”€â”€ Usa interfaces â†’ IProductoRepository, IFakeStoreApiProxy
   â””â”€â”€ Contiene lÃ³gica de negocio (casos de uso)

[ Domain ]
   â””â”€â”€ Define entidades y reglas del negocio

[ Infrastructure ]
   â”œâ”€â”€ Implementa interfaces de Domain o Application
   â””â”€â”€ Maneja datos: BD, APIs externas, logs, etc



--ESUMEN ACTUALIZADO

[ API ]
   â”‚
   â”œâ”€â”€ AddApplication()   -> registra casos de uso (MediatR, DTOs, validaciones)
   â”‚
   â””â”€â”€ AddInfrastructure() -> registra implementaciones concretas (Dapper, HttpClients, repos, logging)


[ Application ]
   â”œâ”€ Define casos de uso (Handlers, Commands/Queries)
   â”œâ”€ Define DTOs que usa la app
   â”œâ”€ Define interfaces necesarias por la app:
   â”‚     â€¢ Interfaces de dominio (a veces en Domain) -> IProductoRepository (para BD propia)
   â”‚     â€¢ Interfaces de servicios externos -> IFakeStoreApiProxy (cuando la app necesita consumir terceros)
   â””â”€ No contiene implementaciones concretas


[ Domain ]
   â””â”€ Entidades del negocio, reglas puras (a veces contiene interfaces de repositorio segÃºn la convenciÃ³n)

[ Infrastructure ]
   â”œâ”€ Implementa las interfaces definidas (en Domain o Application)
   â”‚     â€¢ ProductoRepository : IProductoRepository
   â”‚     â€¢ FakeStoreApiProxy : IFakeStoreApiProxy
   â”œâ”€ Maneja acceso a datos (Dapper/EF), HttpClients, logs, etc.
   â””â”€ Expone mÃ©todo AddInfrastructure(configuration) para registrar todo en DI

